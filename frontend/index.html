<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Competition Scoring Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/ethers@6.4.0/dist/ethers.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            font-family: 'Inter', sans-serif;
        }
        .btn-primary {
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: all 0.3s ease;
        }
        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(90deg, #2563eb, #7c3aed);
            transform: translateY(-2px);
        }
        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .card {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
            transition: all 0.3s ease;
        }
        .card:hover {
            border-color: rgba(59, 130, 246, 0.3);
        }
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        .status-active { background-color: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .status-upcoming { background-color: rgba(251, 191, 36, 0.2); color: #fbbf24; }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3b82f6;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="text-white min-h-screen">
    <!-- Header -->
    <header class="border-b border-gray-800 bg-slate-900/50 backdrop-blur-sm">
        <div class="max-w-7xl mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-xl">üèÜ</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Competition Scoring Platform</h1>
                        <p class="text-gray-400 text-sm">Private Judge Scoring with FHE Technology</p>
                    </div>
                </div>
                <button id="connectWallet" class="btn-primary text-white px-6 py-3 rounded-lg font-medium">
                    Connect Wallet
                </button>
            </div>
        </div>
    </header>

    <!-- Status Messages -->
    <div id="statusContainer" class="fixed top-20 right-4 z-50 max-w-sm"></div>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- Wallet Status -->
        <div id="walletStatus" class="hidden mb-8 p-4 bg-green-900/20 border border-green-500/30 rounded-lg">
            <div class="flex items-center space-x-2">
                <span class="text-green-400 font-medium">Connected:</span>
                <span id="walletAddress" class="text-white"></span>
                <span class="text-gray-400">|</span>
                <span class="text-gray-400">Balance:</span>
                <span id="walletBalance" class="text-white">0.000 ETH</span>
            </div>
        </div>

        <!-- Competition Grid -->
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-white">AI & Blockchain Integration</h3>
                    <span class="status-badge status-active">Active</span>
                </div>
                <p class="text-gray-400 mb-4">Build innovative AI-powered blockchain solutions for the future.</p>
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Entry Fee:</span>
                        <span class="text-white">0.0001 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Prize Pool:</span>
                        <span class="text-white">15 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Ends:</span>
                        <span class="text-white">2026-03-15</span>
                    </div>
                </div>
                <button class="join-btn w-full btn-primary text-white py-2 rounded-lg font-medium" data-competition="1" data-fee="0.0001">
                    Join Competition (0.0001 ETH)
                </button>
            </div>

            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-white">Web3 Gaming Revolution</h3>
                    <span class="status-badge status-active">Active</span>
                </div>
                <p class="text-gray-400 mb-4">Create immersive gaming experiences using blockchain and FHE privacy.</p>
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Entry Fee:</span>
                        <span class="text-white">0.0002 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Prize Pool:</span>
                        <span class="text-white">25 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Ends:</span>
                        <span class="text-white">2026-06-30</span>
                    </div>
                </div>
                <button class="join-btn w-full btn-primary text-white py-2 rounded-lg font-medium" data-competition="2" data-fee="0.0002">
                    Join Competition (0.0002 ETH)
                </button>
            </div>

            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-white">DeFi Innovation Challenge</h3>
                    <span class="status-badge status-active">Active</span>
                </div>
                <p class="text-gray-400 mb-4">Design next-gen DeFi protocols with enhanced privacy features.</p>
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Entry Fee:</span>
                        <span class="text-white">0.0005 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Prize Pool:</span>
                        <span class="text-white">50 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Ends:</span>
                        <span class="text-white">2026-09-15</span>
                    </div>
                </div>
                <button class="join-btn w-full btn-primary text-white py-2 rounded-lg font-medium" data-competition="3" data-fee="0.0005">
                    Join Competition (0.0005 ETH)
                </button>
            </div>

            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-white">Zero-Knowledge Privacy Solutions</h3>
                    <span class="status-badge status-upcoming">Starting Soon</span>
                </div>
                <p class="text-gray-400 mb-4">Build privacy-preserving applications using zero-knowledge proofs.</p>
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Entry Fee:</span>
                        <span class="text-white">0.0003 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Prize Pool:</span>
                        <span class="text-white">30 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Starts:</span>
                        <span class="text-white">2026-01-01</span>
                    </div>
                </div>
                <button class="join-btn w-full btn-primary text-white py-2 rounded-lg font-medium" data-competition="4" data-fee="0.0003">
                    Join Competition (0.0003 ETH)
                </button>
            </div>

            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-white">Sustainable Blockchain Solutions</h3>
                    <span class="status-badge status-upcoming">Starting Soon</span>
                </div>
                <p class="text-gray-400 mb-4">Develop eco-friendly blockchain applications for sustainability.</p>
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Entry Fee:</span>
                        <span class="text-white">0.0002 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Prize Pool:</span>
                        <span class="text-white">20 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Starts:</span>
                        <span class="text-white">2026-02-14</span>
                    </div>
                </div>
                <button class="join-btn w-full btn-primary text-white py-2 rounded-lg font-medium" data-competition="5" data-fee="0.0002">
                    Join Competition (0.0002 ETH)
                </button>
            </div>

            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-start mb-4">
                    <h3 class="text-xl font-semibold text-white">Cross-Chain Interoperability</h3>
                    <span class="status-badge status-upcoming">Opening Soon</span>
                </div>
                <p class="text-gray-400 mb-4">Build innovative cross-chain solutions for seamless interoperability.</p>
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Entry Fee:</span>
                        <span class="text-white">0.0004 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Prize Pool:</span>
                        <span class="text-white">40 ETH</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-sm text-gray-400">Opens:</span>
                        <span class="text-white">2026-04-01</span>
                    </div>
                </div>
                <button class="join-btn w-full btn-primary text-white py-2 rounded-lg font-medium" data-competition="6" data-fee="0.0004">
                    Join Competition (0.0004 ETH)
                </button>
            </div>
        </div>
    </main>

    <script>
        // Contract configuration matching CompetitionPlatform.sol
        const CONTRACT_ADDRESS = "0x3f25F27D0F0816F32C5f6d5EC5b83640c2A0B1ef";
        const CONTRACT_ABI = [
            "function joinCompetition(uint256 competitionId, string participantName, string submission) external payable",
            "function getCompetition(uint256 competitionId) external view returns (string name, uint256 participantCount, uint256 prizePool, bool active)",
            "function hasParticipantJoined(address participant, uint256 competitionId) external view returns (bool)",
            "function getTotalCompetitions() external view returns (uint256)"
        ];

        let provider, signer, contract, userAccount;

        // Status message helper
        function showStatus(message, type = 'info') {
            const container = document.getElementById('statusContainer');
            const statusDiv = document.createElement('div');
            
            const bgColor = {
                'info': 'bg-blue-600',
                'success': 'bg-green-600',
                'error': 'bg-red-600',
                'warning': 'bg-yellow-600'
            }[type] || 'bg-blue-600';
            
            statusDiv.className = `${bgColor} text-white p-4 rounded-lg mb-2 shadow-lg`;
            statusDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 text-white hover:text-gray-200">‚úï</button>
                </div>
            `;
            
            container.appendChild(statusDiv);
            
            if (type !== 'info') {
                setTimeout(() => {
                    if (statusDiv.parentNode) statusDiv.remove();
                }, 5000);
            }
        }

        // Connect wallet
        document.getElementById('connectWallet').onclick = async function() {
            try {
                if (!window.ethereum) {
                    alert('Please install MetaMask!');
                    return;
                }

                showStatus('Connecting wallet...', 'info');

                await window.ethereum.request({ method: 'eth_requestAccounts' });
                provider = new ethers.BrowserProvider(window.ethereum);
                signer = await provider.getSigner();
                userAccount = await signer.getAddress();

                const balance = await provider.getBalance(userAccount);
                const network = await provider.getNetwork();

                // Initialize contract
                contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

                // Update UI
                document.getElementById('walletAddress').textContent = 
                    userAccount.slice(0, 8) + '...' + userAccount.slice(-6);
                document.getElementById('walletBalance').textContent = 
                    parseFloat(ethers.formatEther(balance)).toFixed(4) + ' ETH';
                document.getElementById('walletStatus').classList.remove('hidden');
                document.getElementById('connectWallet').textContent = 'Connected ‚úì';
                document.getElementById('connectWallet').disabled = true;

                showStatus(`Connected to ${network.name}! Ready to join competitions.`, 'success');

            } catch (error) {
                console.error('Connection error:', error);
                showStatus('Failed to connect wallet: ' + error.message, 'error');
            }
        };

        // Join competition
        document.querySelectorAll('.join-btn').forEach(btn => {
            btn.onclick = async function() {
                if (!contract) {
                    showStatus('Please connect your wallet first!', 'error');
                    return;
                }

                const competitionId = parseInt(this.dataset.competition);
                const fee = this.dataset.fee;
                const originalText = this.textContent;

                try {
                    this.disabled = true;
                    this.innerHTML = '<div class="spinner"></div> Joining...';

                    // Get participant info
                    const participantName = prompt('Enter your name for the competition:') || 'Anonymous Participant';
                    const submission = prompt('Enter your project description or URL:') || 'Project submission';

                    if (!participantName.trim() || !submission.trim()) {
                        throw new Error('Name and submission are required');
                    }

                    showStatus(`Joining competition ${competitionId}... Please confirm in MetaMask`, 'info');

                    const feeInWei = ethers.parseEther(fee);
                    const tx = await contract.joinCompetition(
                        competitionId,
                        participantName.trim(),
                        submission.trim(),
                        { value: feeInWei }
                    );

                    showStatus(`Transaction sent! Hash: ${tx.hash.slice(0, 20)}...`, 'info');
                    console.log('Transaction:', tx.hash);

                    const receipt = await tx.wait();
                    console.log('Receipt:', receipt);

                    showStatus(`‚úÖ Successfully joined competition ${competitionId}!`, 'success');
                    
                    this.textContent = 'Joined ‚úì';
                    this.classList.remove('btn-primary');
                    this.classList.add('bg-green-600');

                    // Update balance
                    const newBalance = await provider.getBalance(userAccount);
                    document.getElementById('walletBalance').textContent = 
                        parseFloat(ethers.formatEther(newBalance)).toFixed(4) + ' ETH';

                } catch (error) {
                    console.error('Join error:', error);
                    this.disabled = false;
                    this.textContent = originalText;

                    let errorMsg = 'Join failed: ';
                    if (error.code === 4001) {
                        errorMsg += 'Transaction rejected by user';
                    } else if (error.code === 'INSUFFICIENT_FUNDS') {
                        errorMsg += 'Insufficient balance';
                    } else if (error.reason) {
                        errorMsg += error.reason;
                    } else if (error.message.includes('already joined')) {
                        errorMsg += 'You have already joined this competition';
                    } else {
                        errorMsg += error.message;
                    }

                    showStatus(errorMsg, 'error');
                }
            };
        });

        // Auto-connect if already connected
        window.addEventListener('load', async () => {
            if (window.ethereum && window.ethereum.selectedAddress) {
                document.getElementById('connectWallet').click();
            }
        });
    </script>
</body>
</html>